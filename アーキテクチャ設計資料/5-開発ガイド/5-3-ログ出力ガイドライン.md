# 5-3-ãƒ­ã‚°å‡ºåŠ›ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³

## 1. æ¦‚è¦

æœ¬ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ã¯ã€ç ”ä¿®ç”Ÿå‘ã‘Javaé–‹ç™ºãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«ãŠã‘ã‚‹æœ€å°é™ã®ãƒ­ã‚°å‡ºåŠ›ãƒãƒªã‚·ãƒ¼ã‚’å®šç¾©ã—ã¾ã™ã€‚
éåº¦ã«è¤‡é›‘ã«ãªã‚‰ãšã€å®Ÿè·µçš„ãªãƒ­ã‚°è¨˜éŒ²ã®åŸºç¤ã‚’å­¦ã¹ã‚‹ã“ã¨ã‚’ç›®çš„ã¨ã—ã¦ã„ã¾ã™ã€‚

## 2. ãƒ­ã‚°ãƒ¬ãƒ™ãƒ«ã®ä½¿ã„åˆ†ã‘

### 2.1 ERROR - ã‚¨ãƒ©ãƒ¼ãƒ¬ãƒ™ãƒ«
ã‚·ã‚¹ãƒ†ãƒ ã®æ­£å¸¸ãªå‹•ä½œã‚’å¦¨ã’ã‚‹é‡å¤§ãªå•é¡Œ

**å‡ºåŠ›ã™ã¹ãå†…å®¹ï¼š**
- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šã‚¨ãƒ©ãƒ¼
- SQLã‚¨ãƒ©ãƒ¼ï¼ˆåˆ¶ç´„é•åãªã©ï¼‰
- äºˆæœŸã—ãªã„ä¾‹å¤–
- ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ã‚¯ã‚»ã‚¹ã‚¨ãƒ©ãƒ¼

**ä¾‹ï¼š**
```java
log.error("ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²ã«å¤±æ•—ã—ã¾ã—ãŸã€‚Emailé‡è¤‡: {}", email, e);
```

### 2.2 WARN - è­¦å‘Šãƒ¬ãƒ™ãƒ«
å‡¦ç†ã¯ç¶™ç¶šã§ãã‚‹ãŒã€æ³¨æ„ãŒå¿…è¦ãªäº‹è±¡

**å‡ºåŠ›ã™ã¹ãå†…å®¹ï¼š**
- ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«é•å
- éæ¨å¥¨æ©Ÿèƒ½ã®ä½¿ç”¨
- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã®é–¾å€¤è¶…é
- ãƒªãƒˆãƒ©ã‚¤å‡¦ç†

**ä¾‹ï¼š**
```java
log.warn("ç„¡åŠ¹ãªã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å¤‰æ›´ãŒè©¦è¡Œã•ã‚Œã¾ã—ãŸã€‚ãƒ¦ãƒ¼ã‚¶ãƒ¼ID: {}, ç¾åœ¨: {}, è¦æ±‚: {}", 
         userId, currentStatus, requestedStatus);
```

### 2.3 INFO - æƒ…å ±ãƒ¬ãƒ™ãƒ«
æ­£å¸¸ãªå‡¦ç†ã®é‡è¦ãªãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³

**å‡ºåŠ›ã™ã¹ãå†…å®¹ï¼š**
- CRUDæ“ä½œã®å®Œäº†ï¼ˆä½œæˆã€æ›´æ–°ã€å‰Šé™¤ï¼‰
- ãƒ­ã‚°ã‚¤ãƒ³/ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ
- ãƒãƒƒãƒå‡¦ç†ã®é–‹å§‹/çµ‚äº†
- é‡è¦ãªçŠ¶æ…‹å¤‰æ›´

**ä¾‹ï¼š**
```java
log.info("ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæ­£å¸¸ã«ç™»éŒ²ã•ã‚Œã¾ã—ãŸã€‚ID: {}, åå‰: {}", user.getId(), user.getName());
log.info("ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ãŒæ›´æ–°ã•ã‚Œã¾ã—ãŸã€‚ID: {}", userId);
log.info("ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå‰Šé™¤ã•ã‚Œã¾ã—ãŸã€‚ID: {}", userId);
```

### 2.4 DEBUG - ãƒ‡ãƒãƒƒã‚°ãƒ¬ãƒ™ãƒ«
é–‹ç™ºæ™‚ã®ãƒ‡ãƒãƒƒã‚°ç”¨ï¼ˆæœ¬ç•ªç’°å¢ƒã§ã¯ç„¡åŠ¹åŒ–ï¼‰

**å‡ºåŠ›ã™ã¹ãå†…å®¹ï¼š**
- ãƒ¡ã‚½ãƒƒãƒ‰ã®é–‹å§‹/çµ‚äº†
- å¤‰æ•°ã®å€¤
- SQLæ–‡
- è©³ç´°ãªå‡¦ç†ãƒ•ãƒ­ãƒ¼

**ä¾‹ï¼š**
```java
log.debug("findByIdé–‹å§‹ã€‚ID: {}", id);
log.debug("æ¤œç´¢çµæœ: {}", user);
```

## 3. å®Ÿè£…ä¾‹

### 3.1 Loggerã®å®šç¾©

```java
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

@Service
public class UserService {
    private static final Logger log = LoggerFactory.getLogger(UserService.class);
    
    // ...
}
```

### 3.2 ã‚µãƒ¼ãƒ“ã‚¹ã‚¯ãƒ©ã‚¹ã§ã®å®Ÿè£…ä¾‹

```java
@Service
public class UserService {
    private static final Logger log = LoggerFactory.getLogger(UserService.class);
    
    public User createUser(User user) {
        try {
            // ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
            if (userRepository.existsByEmail(user.getEmail())) {
                log.warn("ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹é‡è¤‡: {}", user.getEmail());
                throw new DuplicateEmailException("ã“ã®ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¯æ—¢ã«ä½¿ç”¨ã•ã‚Œã¦ã„ã¾ã™");
            }
            
            // ä¿å­˜å‡¦ç†
            User savedUser = userRepository.save(user);
            log.info("ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²å®Œäº† - ID: {}, åå‰: {}, ãƒ¡ãƒ¼ãƒ«: {}", 
                    savedUser.getId(), savedUser.getName(), savedUser.getEmail());
            
            return savedUser;
            
        } catch (DataAccessException e) {
            log.error("ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²ä¸­ã«ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚ãƒ¡ãƒ¼ãƒ«: {}", 
                     user.getEmail(), e);
            throw new ServiceException("ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²ã«å¤±æ•—ã—ã¾ã—ãŸ", e);
        }
    }
    
    public void deleteUser(Long userId) {
        try {
            if (!userRepository.existsById(userId)) {
                log.warn("å­˜åœ¨ã—ãªã„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å‰Šé™¤ãŒè©¦è¡Œã•ã‚Œã¾ã—ãŸã€‚ID: {}", userId);
                throw new UserNotFoundException("ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“");
            }
            
            userRepository.deleteById(userId);
            log.info("ãƒ¦ãƒ¼ã‚¶ãƒ¼å‰Šé™¤å®Œäº† - ID: {}", userId);
            
        } catch (DataAccessException e) {
            log.error("ãƒ¦ãƒ¼ã‚¶ãƒ¼å‰Šé™¤ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚ID: {}", userId, e);
            throw new ServiceException("ãƒ¦ãƒ¼ã‚¶ãƒ¼å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ", e);
        }
    }
}
```

### 3.3 ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã‚¯ãƒ©ã‚¹ã§ã®å®Ÿè£…ä¾‹

```java
@RestController
@RequestMapping("/api/users")
public class UserController {
    private static final Logger log = LoggerFactory.getLogger(UserController.class);
    
    @PostMapping
    public ResponseEntity<User> createUser(@Valid @RequestBody User user) {
        log.info("ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²ãƒªã‚¯ã‚¨ã‚¹ãƒˆå—ä¿¡ - åå‰: {}", user.getName());
        
        try {
            User created = userService.createUser(user);
            return ResponseEntity.ok(created);
            
        } catch (DuplicateEmailException e) {
            log.warn("ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²å¤±æ•— - {}", e.getMessage());
            return ResponseEntity.badRequest().build();
            
        } catch (Exception e) {
            log.error("äºˆæœŸã—ãªã„ã‚¨ãƒ©ãƒ¼", e);
            return ResponseEntity.internalServerError().build();
        }
    }
}
```

## 4. ãƒ­ã‚°å‡ºåŠ›è¨­å®š

### 4.1 application.properties ã®è¨­å®š

```properties
# ãƒ­ã‚°ãƒ¬ãƒ™ãƒ«è¨­å®š
logging.level.root=INFO
logging.level.com.javatraining.backend=INFO
logging.level.org.springframework.web=WARN
logging.level.org.hibernate.SQL=DEBUG
logging.level.org.hibernate.type.descriptor.sql.BasicBinder=TRACE

# ãƒ•ã‚¡ã‚¤ãƒ«å‡ºåŠ›è¨­å®š
logging.file.name=logs/application.log
logging.file.max-size=10MB
logging.file.max-history=30

# ã‚³ãƒ³ã‚½ãƒ¼ãƒ«å‡ºåŠ›ãƒ‘ã‚¿ãƒ¼ãƒ³
logging.pattern.console=%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n

# ãƒ•ã‚¡ã‚¤ãƒ«å‡ºåŠ›ãƒ‘ã‚¿ãƒ¼ãƒ³
logging.pattern.file=%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n
```

## 5. ãƒ­ã‚°å‡ºåŠ›ã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

### 5.1 ã‚„ã‚‹ã¹ãã“ã¨
- âœ… ãƒ¦ãƒ¼ã‚¶ãƒ¼IDãªã©ã€è¿½è·¡å¯èƒ½ãªè­˜åˆ¥å­ã‚’å«ã‚ã‚‹
- âœ… ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯æ—¥æœ¬èªã§åˆ†ã‹ã‚Šã‚„ã™ã
- âœ… ä¾‹å¤–ã‚’ãƒ­ã‚°ã«è¨˜éŒ²ã™ã‚‹éš›ã¯ã€ã‚¹ã‚¿ãƒƒã‚¯ãƒˆãƒ¬ãƒ¼ã‚¹ã‚‚å«ã‚ã‚‹
- âœ… æ©Ÿå¯†æƒ…å ±ï¼ˆãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã€ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆã‚«ãƒ¼ãƒ‰ç•ªå·ï¼‰ã¯çµ¶å¯¾ã«è¨˜éŒ²ã—ãªã„

### 5.2 é¿ã‘ã‚‹ã¹ãã“ã¨
- âŒ ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚„å€‹äººæƒ…å ±ã‚’ãƒ­ã‚°ã«å‡ºåŠ›
- âŒ ã™ã¹ã¦ã®ãƒ¡ã‚½ãƒƒãƒ‰ã«DEBUGãƒ­ã‚°ã‚’è¿½åŠ 
- âŒ å·¨å¤§ãªã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ãã®ã¾ã¾ãƒ­ã‚°å‡ºåŠ›
- âŒ ãƒ«ãƒ¼ãƒ—å†…ã§ã®éå‰°ãªãƒ­ã‚°å‡ºåŠ›

### 5.3 ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è€ƒæ…®äº‹é …

```java
// æ‚ªã„ä¾‹
log.info("ãƒ­ã‚°ã‚¤ãƒ³è©¦è¡Œ - ãƒ¡ãƒ¼ãƒ«: {}, ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰: {}", email, password);

// è‰¯ã„ä¾‹
log.info("ãƒ­ã‚°ã‚¤ãƒ³è©¦è¡Œ - ãƒ¡ãƒ¼ãƒ«: {}", email);
```

## 6. ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ç”¨ãƒ­ã‚°

å•é¡ŒãŒç™ºç”Ÿã—ãŸéš›ã«èª¿æŸ»ã—ã‚„ã™ã„ã‚ˆã†ã€ä»¥ä¸‹ã®æƒ…å ±ã‚’å«ã‚ã‚‹ã“ã¨ã‚’æ¨å¥¨ï¼š

```java
// ãƒªã‚¯ã‚¨ã‚¹ãƒˆIDã‚’ä½¿ã£ãŸè¿½è·¡
@Component
public class LoggingInterceptor extends HandlerInterceptorAdapter {
    @Override
    public boolean preHandle(HttpServletRequest request, 
                           HttpServletResponse response, 
                           Object handler) {
        String requestId = UUID.randomUUID().toString();
        MDC.put("requestId", requestId);
        log.info("ãƒªã‚¯ã‚¨ã‚¹ãƒˆé–‹å§‹ - {} {}", request.getMethod(), request.getRequestURI());
        return true;
    }
    
    @Override
    public void afterCompletion(HttpServletRequest request, 
                               HttpServletResponse response, 
                               Object handler, 
                               Exception ex) {
        log.info("ãƒªã‚¯ã‚¨ã‚¹ãƒˆå®Œäº† - ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: {}", response.getStatus());
        MDC.clear();
    }
}
```

## 7. ç ”ä¿®ç”Ÿã¸ã®æ¨å¥¨äº‹é …

1. **æœ€åˆã¯å°‘ãªã‚ã«**
   - æœ€åˆã¯INFOã¨ERRORãƒ¬ãƒ™ãƒ«ã®ã¿ã‚’å®Ÿè£…
   - å¿…è¦ã«å¿œã˜ã¦å¾ã€…ã«è¿½åŠ 

2. **ä¸€è²«æ€§ã‚’ä¿ã¤**
   - ãƒãƒ¼ãƒ å†…ã§ãƒ­ã‚°ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã‚’çµ±ä¸€
   - åŒã˜ã‚ˆã†ãªå‡¦ç†ã«ã¯åŒã˜ãƒ¬ãƒ™ãƒ«ã®ãƒ­ã‚°ã‚’ä½¿ç”¨

3. **ãƒ¬ãƒ“ãƒ¥ãƒ¼ã®è¦³ç‚¹**
   - ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼æ™‚ã«ãƒ­ã‚°ã®é©åˆ‡æ€§ã‚‚ç¢ºèª
   - æ©Ÿå¯†æƒ…å ±ãŒå«ã¾ã‚Œã¦ã„ãªã„ã‹ãƒã‚§ãƒƒã‚¯

## 8. ã¾ã¨ã‚

ã“ã®ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³ã«å¾“ã†ã“ã¨ã§ã€ä»¥ä¸‹ã®ãƒ¡ãƒªãƒƒãƒˆãŒå¾—ã‚‰ã‚Œã¾ã™ï¼š

- ğŸ¯ å•é¡Œç™ºç”Ÿæ™‚ã®è¿…é€ŸãªåŸå› ç‰¹å®š
- ğŸ“Š ã‚·ã‚¹ãƒ†ãƒ ã®å‹•ä½œçŠ¶æ³ã®æŠŠæ¡
- ğŸ” ç›£æŸ»è¦ä»¶ã¸ã®å¯¾å¿œ
- ğŸ“š å®Ÿè·µçš„ãªãƒ­ã‚°è¨˜éŒ²ã‚¹ã‚­ãƒ«ã®ç¿’å¾—

ç ”ä¿®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯ã€å®Œç’§ãªãƒ­ã‚°å‡ºåŠ›ã‚ˆã‚Šã‚‚ã€é©åˆ‡ãªãƒ­ã‚°ãƒ¬ãƒ™ãƒ«ã®ä½¿ã„åˆ†ã‘ã¨ã€æ©Ÿå¯†æƒ…å ±ã‚’è¨˜éŒ²ã—ãªã„ã¨ã„ã†åŸºæœ¬åŸå‰‡ã®ç†è§£ãŒé‡è¦ã§ã™ã€‚