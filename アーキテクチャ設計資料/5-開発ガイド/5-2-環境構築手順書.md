# 5-2-環境構築手順書

## プロジェクト概要
このプロジェクトは、Spring Boot 3.4.8を使用したJava研修用アプリケーションです。SQLのJOIN操作とUIフォームコントロールの実装を学習することが目的です。

**初心者の方へ**: この手順書は、プログラミング初心者でも迷わず環境構築できるよう、全ての手順を詳しく説明しています。分からない用語や概念があれば、遠慮なく質問してください。

## 前提条件・必要なソフトウェア
以下のソフトウェアが必要です。各項目について詳しく説明します：

- **Java 21** (必須) - Javaプログラムを実行するための基盤ソフトウェア
- **Docker** (PostgreSQLデータベース用) - データベースを簡単に起動するためのコンテナ技術
- **Git** (ソースコード管理用) - プロジェクトのソースコードを取得するため
- **インターネット接続** (Maven依存関係ダウンロード用) - 必要なライブラリを自動ダウンロードするため

**用語解説:**
- **Java 21**: Javaプログラミング言語の最新バージョン。数字が大きいほど新しい
- **Docker**: アプリケーションを「コンテナ」という箱に入れて動かす技術
- **Maven**: Javaプロジェクトの管理ツール。必要なライブラリを自動で取得してくれる

---

## 1. Windows環境の準備 - WSL2のインストール（Windowsユーザー必須）

**🪟 このセクションはWindowsユーザーのみ対象です。macOS・Linuxユーザーは「2. Java 21のインストール」へ進んでください。**

**WSL（Windows Subsystem for Linux）とは？**: WindowsでLinux環境を使えるようにする機能です。開発作業はLinux環境の方が適しているため、Windowsでも同じような環境を作ります。

**なぜWSLが必要？**:
- Docker DesktopがWSL2を必要とするため
- 開発ツールの多くがLinux環境で設計されているため
- 他の開発者（macOS・Linux使用）と同じコマンドが使えるため
- ファイルパスの問題（スペースや日本語）を避けられるため

### 1-1. Windowsバージョンを確認しよう

**必要なWindowsバージョン:**
- Windows 10 バージョン2004以降（Build 19041以降）
- または Windows 11（すべてのバージョン）

**バージョン確認方法:**
1. Windowsキー + R を押す
2. `winver` と入力してEnter
3. 表示されたウィンドウでバージョンを確認

**バージョンが古い場合:** Windows Updateで最新版にアップデートしてください。

### 1-2. WSL2を有効化しよう

**管理者権限でPowerShellを開く:**
1. スタートメニューで「PowerShell」を検索
2. 「Windows PowerShell」を右クリック
3. 「管理者として実行」を選択
4. UAC（ユーザーアカウント制御）で「はい」をクリック

**WSL機能を有効化:**
```powershell
# WSL機能を有効化
dism.exe /online /enable-feature /featurename:Microsoft-Windows-Subsystem-Linux /all /norestart

# 仮想マシン機能を有効化（WSL2に必要）
dism.exe /online /enable-feature /featurename:VirtualMachinePlatform /all /norestart
```

**⚠️ 重要**: コマンド実行後、Windowsを再起動してください。

### 1-3. WSL2をデフォルトバージョンに設定

**再起動後、再び管理者権限でPowerShellを開いて:**
```powershell
# WSL2をデフォルトバージョンに設定
wsl --set-default-version 2
```

### 1-4. Linuxディストリビューションをインストール

**Microsoft Storeを開いてUbuntuをインストール:**
1. スタートメニューで「Microsoft Store」を検索して開く
2. 検索欄で「Ubuntu 22.04.3 LTS」を検索
3. 「入手」または「インストール」をクリック
4. インストール完了まで待つ（数分かかります）

**または、PowerShellでコマンドインストール:**
```powershell
# Ubuntuをインストール
wsl --install -d Ubuntu-22.04
```

### 1-5. Ubuntuの初期設定

**Ubuntuを起動:**
1. スタートメニューで「Ubuntu」を検索
2. 「Ubuntu 22.04.3 LTS」をクリック
3. 初回起動時は初期化処理が実行される（数分待つ）

**ユーザーアカウントの作成:**
```
Installing, this may take a few minutes...
Please create a default UNIX user account. The username does not need to match your Windows username.
For more information visit: https://aka.ms/wslusers
Enter new UNIX username: [ユーザー名を入力]
Enter new UNIX password: [パスワードを入力]
Retype new UNIX password: [パスワードを再入力]
```

**推奨設定:**
- ユーザー名: 英数字のみ（例：`developer`, `trainee`など）
- パスワード: 覚えやすいもの（入力時は表示されません）

### 1-6. WSL2が正常に動作するか確認

**PowerShell（またはコマンドプロンプト）で確認:**
```powershell
# WSLの状態を確認
wsl --list --verbose
```

**期待する出力:**
```
  NAME            STATE           VERSION
* Ubuntu-22.04    Running         2
```

**確認ポイント:**
- ✅ `VERSION` が `2` になっている（WSL2が有効）
- ✅ `STATE` が `Running` になっている
- ✅ 名前の前に `*` がついている（デフォルト）

### 1-7. Ubuntu内でパッケージを更新

**Ubuntuターミナルで以下を実行:**
```bash
# パッケージリストを更新
sudo apt update

# インストール済みパッケージを最新版にアップデート
sudo apt upgrade -y

# 基本的な開発ツールをインストール
sudo apt install -y curl wget git vim
```

**`sudo` について**: 管理者権限でコマンドを実行するためのコマンドです。パスワードを求められたら、1-5で設定したパスワードを入力してください。

### 1-8. Windowsとの連携確認

**Windows側のフォルダにアクセステスト:**
```bash
# Cドライブにアクセス
ls /mnt/c/

# デスクトップフォルダにアクセス
ls /mnt/c/Users/$USER/Desktop/
```

**Ubuntu側から見たWindowsのファイルパス:**
- Cドライブ: `/mnt/c/`
- ユーザーフォルダ: `/mnt/c/Users/[Windowsユーザー名]/`
- デスクトップ: `/mnt/c/Users/[Windowsユーザー名]/Desktop/`

### 1-9. 作業フォルダの準備

**Ubuntu内に作業フォルダを作成（推奨）:**
```bash
# ホームディレクトリに移動
cd ~

# 作業用フォルダを作成
mkdir workspace
cd workspace

# 現在の場所を確認
pwd
# /home/[ユーザー名]/workspace と表示されることを確認
```

**なぜUbuntu内に作業フォルダを作るのか？**
- ファイルアクセスが高速
- パスにスペースや日本語が含まれない
- 権限問題が発生しにくい

### 1-10. ⚠️ 重要な注意事項

**1. ターミナルの使い分け:**
- **Ubuntu（WSL）ターミナル**: 開発作業で使用（推奨）
- **PowerShell**: Windows設定やWSL管理で使用
- **コマンドプロンプト**: 基本的に使わない

**2. ファイルパスについて:**
- **Ubuntu内での作業**: `/home/username/workspace/` を使用
- **Windows側からアクセス**: `\\wsl$\Ubuntu-22.04\home\username\workspace\`

**3. WSLを終了・再起動する方法:**
```powershell
# WSLを終了
wsl --shutdown

# 特定のディストリビューションを終了
wsl --terminate Ubuntu-22.04
```

**4. Visual Studio Code連携（オプション）:**
VS Codeを使用する場合は、「Remote - WSL」拡張機能をインストールすることで、WSL環境で直接開発できます。

---

## 2. Java 21のインストール

**なぜJavaが必要？**: このプロジェクトはJavaというプログラミング言語で書かれています。Javaで書かれたプログラムを動かすには、Javaの実行環境（JVM）が必要です。

### 2-1. 現在のJavaバージョンを確認しよう

**ターミナルの開き方:**
- **Windows**: スタートメニューで「Ubuntu」と検索 → 「Ubuntu 22.04.3 LTS」を開く（WSL環境）
- **macOS**: Spotlight検索（⌘+Space）で「terminal」と入力 → 「ターミナル」を開く
- **Linux**: Ctrl+Alt+T でターミナルを開く

**⚠️ Windowsユーザーへの重要な注意**: 
必ずUbuntu（WSL）ターミナルを使用してください。コマンドプロンプトやPowerShellは使用しないでください。

**以下のコマンドを入力してEnterキーを押してください:**
```bash
java -version
```

**結果の見方:**
- `java: command not found` と表示 → Javaがインストールされていません（1-2へ）
- `openjdk version "21.x.x"` と表示 → Java 21が既にインストール済み（2章へ進む）
- `openjdk version "17.x.x"` など他のバージョン → 古いバージョンです（1-2へ）

**コンパイラも確認しましょう:**
```bash
javac -version
```

### 2-2. Java 21をインストールしよう

#### 🍎 macOSの場合:

**Homebrewを使ったインストール（推奨）:**

**Homebrewとは？**: macOS用のパッケージ管理ツールです。ソフトウェアの インストール・更新・削除を簡単にできます。

1. **Homebrewがインストールされているか確認:**
```bash
brew --version
```

2. **Homebrewがない場合は先にインストール:**
```bash
/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
```

3. **Java 21をインストール:**
```bash
brew install openjdk@21
```

4. **パスを設定（重要！）:**
```bash
echo 'export PATH="/opt/homebrew/opt/openjdk@21/bin:$PATH"' >> ~/.zshrc
source ~/.zshrc
```

**パス設定の説明**: システムが新しくインストールしたJavaを見つけられるよう、場所を教えてあげる設定です。

#### 🪟 Windows（WSL Ubuntu）/ 🐧 Linuxの場合:

**Ubuntu環境でのインストール:**
```bash
# パッケージリストを更新
sudo apt update

# Java 21をインストール
sudo apt install openjdk-21-jdk
```

**インストール中の確認メッセージ:**
- 「Do you want to continue? [Y/n]」と表示されたら「Y」を入力してEnter
- インストールには数分かかります

**CentOS/RHEL系Linuxの場合:**
```bash
# Java 21をインストール
sudo yum install java-21-openjdk-devel
```

### 2-3. インストールが成功したか確認しよう

**新しいターミナルを開いて以下を実行:**
```bash
java -version
```

**期待する出力例:**
```
openjdk version "21.0.1" 2023-10-17
OpenJDK Runtime Environment (build 21.0.1+12-29)
OpenJDK 64-Bit Server VM (build 21.0.1+12-29, mixed mode, sharing)
```

**コンパイラも確認:**
```bash
javac -version
```

**期待する出力例:**
```
javac 21.0.1
```

**⚠️ トラブルシューティング:**
- `command not found` が表示される場合 → 環境変数の設定をもう一度確認
- 古いバージョンが表示される場合 → 新しいターミナルを開き直す
- それでも解決しない場合 → システムを再起動してから再度確認

---

## 3. Dockerのインストール

**Dockerとは？**: アプリケーションを「コンテナ」という独立した環境で動かす技術です。今回はPostgreSQLというデータベースをコンテナで動かします。

**なぜDockerを使う？**: 
- データベースのインストールと設定が複雑だから
- 他の開発者と全く同じ環境を簡単に作れるから
- 不要になったら簡単に削除できるから

### 3-1. Dockerがインストールされているか確認しよう

**ターミナル・コマンドプロンプトで以下を実行:**
```bash
docker --version
```

**結果の見方:**
- `Docker version 20.x.x` などが表示 → インストール済み（2-3へ進む）
- `command not found` と表示 → インストールが必要（2-2へ）

**Docker Composeも確認しましょう:**
```bash
docker-compose --version
```
または新しいバージョンでは:
```bash
docker compose version
```

### 3-2. Dockerをインストールしよう

#### 🍎 macOS / 🪟 Windowsの場合:

**Docker Desktopを使用（推奨）:**

1. **Docker Desktopをダウンロード:**
   - [Docker Desktop公式サイト](https://www.docker.com/products/docker-desktop/)にアクセス
   - 「Download Docker Desktop」をクリック
   - お使いのOS（Mac/Windows）を選択

2. **システム要件を確認:**
   - **Windows**: Windows 10 64-bit (Build 19041以降) または Windows 11
   - **macOS**: macOS 11 Big Sur以降

3. **インストーラーを実行:**
   - **Mac**: .dmgファイルをダブルクリック → Docker.appをApplicationsフォルダにドラッグ
   - **Windows**: .exeファイルをダブルクリック → インストーラーの指示に従う

4. **Docker Desktopを起動:**
   - アプリケーション一覧からDocker Desktopを起動
   - 初回起動時は使用許諾契約に同意
   - アカウント作成は「Skip」しても大丈夫

5. **起動確認:**
   - 画面右下（Windows）または上部（Mac）にDockerアイコンが表示される
   - アイコンが緑色になるまで待つ

#### 🐧 Linuxの場合:

**Ubuntu/Debianの場合:**
```bash
# 古いDockerを削除（もしあれば）
sudo apt-get remove docker docker-engine docker.io containerd runc

# 必要なパッケージをインストール
sudo apt-get update
sudo apt-get install ca-certificates curl gnupg lsb-release

# DockerのGPGキーを追加
sudo mkdir -m 0755 -p /etc/apt/keyrings
curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg

# Dockerのリポジトリを追加
echo "deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable" | sudo tee /etc/apt/sources.list.d/docker.list > /dev/null

# Dockerをインストール
sudo apt-get update
sudo apt-get install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin

# 現在のユーザーをdockerグループに追加（sudo不要にする）
sudo usermod -aG docker $USER

# 設定を反映させるため、一度ログアウト・ログインが必要
```

### 3-3. Dockerが正常に動作するか確認しよう

**テスト用のコンテナを実行:**
```bash
docker run hello-world
```

**期待する出力例:**
```
Hello from Docker!
This message shows that your installation appears to be working correctly.
...
```

**⚠️ トラブルシューティング:**
- **「permission denied」エラー（Linux）**: `sudo usermod -aG docker $USER` を実行後、ログアウト・ログイン
- **Docker Desktopが起動しない**: システム要件を確認し、必要に応じてWSL2（Windows）を有効化
- **「Docker daemon is not running」エラー**: Docker Desktopが起動していることを確認

---

## 4. プロジェクトのクローン

**Gitとは？**: プログラムのソースコードを管理するツールです。「クローン」とは、リモートにあるプロジェクトのコピーを自分のパソコンに作ることです。

### 4-1. Gitがインストールされているか確認

**ターミナル・コマンドプロンプトで以下を実行:**
```bash
git --version
```

**結果の見方:**
- `git version 2.x.x` などが表示 → インストール済み（3-2へ進む）
- `command not found` と表示 → Gitのインストールが必要

**Gitのインストール（必要な場合）:**
- **Windows**: [Git for Windows](https://gitforwindows.org/)をダウンロード・インストール
- **macOS**: `brew install git` または [公式サイト](https://git-scm.com/)からダウンロード
- **Linux**: `sudo apt install git` （Ubuntu/Debian） / `sudo yum install git` （CentOS/RHEL）

### 4-2. プロジェクトをクローンしよう

**作業用フォルダに移動:**
```bash
# デスクトップに移動（推奨）
cd ~/Desktop

# または Documents フォルダに移動
cd ~/Documents
```

**プロジェクトをクローン:**
```bash
git clone <リポジトリURL>
cd train-trainee
```

**⚠️ 重要**: `<リポジトリURL>` の部分は、実際のプロジェクトのURLに置き換えてください。
例: `git clone https://github.com/username/train-trainee.git`

**クローンとは何をしているか？**
1. リモートサーバーからプロジェクトのファイルを全てダウンロード
2. `train-trainee` というフォルダを作成
3. そのフォルダ内にプロジェクトファイルを配置

### 4-3. プロジェクト構成を確認しよう

**プロジェクトフォルダに入る:**
```bash
cd train-trainee
```

**ファイル一覧を確認:**
```bash
# Windows（コマンドプロンプト）の場合
dir

# macOS/Linux（ターミナル）の場合
ls -la
```

**確認すべきファイル・フォルダ:**
- ✅ `pom.xml` - Mavenの設定ファイル（重要！）
- ✅ `mvnw` / `mvnw.cmd` - Maven Wrapper（重要！）
- ✅ `src/` - ソースコードが入っているフォルダ
- ✅ `CLAUDE.md` - プロジェクトの説明ファイル

**これらのファイルがない場合:**
1. 正しいフォルダにいるか確認: `pwd` コマンドで現在地を確認
2. クローンが正常に完了したか確認
3. リポジトリURLが正しいか確認

---

## 5. PostgreSQLデータベースの起動

**PostgreSQLとは？**: データを保存・管理するデータベースシステムです。今回はユーザー情報やスキル情報を保存します。

**なぜDockerでデータベースを起動する？**
- PostgreSQLを直接インストールすると設定が複雑
- Dockerなら1つのコマンドで簡単に起動できる
- 開発が終わったら簡単に削除できる

### 5-1. PostgreSQLコンテナを起動しよう

**以下のコマンドをターミナル・コマンドプロンプトで実行:**

**Windows（コマンドプロンプト）の場合:**
```bash
docker run -d -p 5432:5432 -e POSTGRES_USER=trainee -e POSTGRES_PASSWORD=trainee -e POSTGRES_DB=traineedb --name trainee-postgres postgres:15
```

**macOS/Linux（ターミナル）の場合:**
```bash
docker run -d \
  -p 5432:5432 \
  -e POSTGRES_USER=trainee \
  -e POSTGRES_PASSWORD=trainee \
  -e POSTGRES_DB=traineedb \
  --name trainee-postgres \
  postgres:15
```

**コマンドの説明:**
- `docker run` - 新しいコンテナを実行
- `-d` - バックグラウンドで実行（デタッチモード）
- `-p 5432:5432` - ポート5432をローカルに公開
- `-e POSTGRES_USER=trainee` - データベースユーザー名を設定
- `-e POSTGRES_PASSWORD=trainee` - パスワードを設定
- `-e POSTGRES_DB=traineedb` - データベース名を設定
- `--name trainee-postgres` - コンテナに名前をつける
- `postgres:15` - PostgreSQL 15のイメージを使用

**初回実行時の動作:**
1. PostgreSQLのDockerイメージをダウンロード（数分かかる場合があります）
2. コンテナを作成・起動
3. データベースを初期化

### 5-2. コンテナが正常に起動したか確認しよう

**実行中のコンテナを確認:**
```bash
docker ps
```

**期待する出力例:**
```
CONTAINER ID   IMAGE         COMMAND                  CREATED         STATUS         PORTS                    NAMES
abc123def456   postgres:15   "docker-entrypoint.s…"   2 minutes ago   Up 2 minutes   0.0.0.0:5432->5432/tcp   trainee-postgres
```

**確認ポイント:**
- ✅ `STATUS` が `Up XX minutes` になっている
- ✅ `NAMES` が `trainee-postgres` になっている
- ✅ `PORTS` が `0.0.0.0:5432->5432/tcp` になっている

**コンテナが表示されない場合:**
1. エラーメッセージを確認: `docker logs trainee-postgres`
2. 停止したコンテナも含めて確認: `docker ps -a`
3. すでに同名のコンテナがある場合: `docker rm trainee-postgres` で削除後再実行

### 5-3. データベースに接続できるか確認しよう

**データベースに接続してテスト:**
```bash
docker exec -it trainee-postgres psql -U trainee -d traineedb
```

**期待する表示:**
```
psql (15.x)
Type "help" for help.

traineedb=>
```

**接続テスト:**
```sql
-- バージョンを確認
SELECT version();

-- データベース一覧を表示
\l

-- 接続を終了
\q
```

**コマンドの説明:**
- `docker exec` - 実行中のコンテナ内でコマンドを実行
- `-it` - インタラクティブモード（対話モード）
- `trainee-postgres` - コンテナ名
- `psql` - PostgreSQLのコマンドラインツール
- `-U trainee` - ユーザー名を指定
- `-d traineedb` - データベース名を指定

**⚠️ トラブルシューティング:**
- **「could not connect」エラー**: コンテナが起動するまで1-2分待つ
- **「database does not exist」エラー**: コンテナを削除して再作成 `docker rm -f trainee-postgres`
- **「port is already allocated」エラー**: ポート5432が他で使用されている → 他のPostgreSQLを停止

---

## 6. プロジェクトのビルドと実行

**Mavenとは？**: Javaプロジェクトの管理ツールです。必要なライブラリのダウンロード、コンパイル、テスト実行などを自動化してくれます。

**Maven Wrapper（mvnw）とは？**: Mavenをインストールしなくても、プロジェクトに付属するスクリプトでMavenを使える仕組みです。

### 6-1. プロジェクトをビルドしよう

**まず、正しいフォルダにいることを確認:**
```bash
# 現在のフォルダを確認
pwd

# train-traineeフォルダにいることを確認
# もしいない場合は移動する
cd train-trainee
```

**ビルドを実行:**

**Windows（コマンドプロンプト）の場合:**
```bash
mvnw.cmd clean package
```

**macOS/Linux（ターミナル）の場合:**
```bash
./mvnw clean package
```

**コマンドの説明:**
- `mvnw` - Maven Wrapper（プロジェクト専用のMaven）
- `clean` - 前回のビルド結果をクリア
- `package` - コンパイル→テスト実行→JARファイル作成

**⚠️ 重要**: 初回実行時は以下が行われるため、時間がかかります（5-15分）:
1. Maven本体のダウンロード
2. 必要なライブラリ（依存関係）のダウンロード
3. ソースコードのコンパイル
4. テストの実行

**実行中に表示されるメッセージ（正常）:**
```
Downloading Maven...
Downloading from central: https://repo1.maven.org/maven2/...
[INFO] Scanning for projects...
[INFO] Building javabackend-training 0.0.1-SNAPSHOT
[INFO] Compiling XX source files to target/classes
[INFO] Running tests...
```

### 6-2. ビルドが成功したか確認しよう

**ビルド完了時のメッセージを確認:**
```
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
[INFO] Total time: 02:15 min
[INFO] Finished at: 2024-xx-xxTxx:xx:xx+09:00
[INFO] ------------------------------------------------------------------------
```

**確認ポイント:**
- ✅ `BUILD SUCCESS` が表示されている
- ✅ エラーメッセージが表示されていない
- ✅ `target/` フォルダが作成されている

**ビルド成果物を確認:**
```bash
# Windows
dir target

# macOS/Linux  
ls -la target/
```

`backend-0.0.1-SNAPSHOT.jar` というファイルが作成されていれば成功です。

### 6-3. アプリケーションを起動しよう

**⚠️ 事前確認**: PostgreSQLコンテナが起動していることを確認
```bash
docker ps
# trainee-postgresが Running 状態であることを確認
```

**アプリケーションを起動:**

**Windows（コマンドプロンプト）の場合:**
```bash
mvnw.cmd spring-boot:run
```

**macOS/Linux（ターミナル）の場合:**
```bash
./mvnw spring-boot:run
```

**起動過程で表示されるメッセージ:**
```
[INFO] --- spring-boot:3.4.8:run (default-cli) @ backend ---
[INFO] Attaching agents: []

  .   ____          _            __ _ _
 /\\ / ___'_ __ _ _(_)_ __  __ _ \ \ \ \
( ( )\___ | '_ | '_| | '_ \/ _` | \ \ \ \
 \\/  ___)| |_)| | | | | || (_| |  ) ) ) )
  '  |____| .__|_| |_|_| |_\__, | / / / /
 =========|_|==============|___/=/_/_/_/
 :: Spring Boot ::                (v3.4.8)

INFO --- [main] c.j.b.JavabackendTrainingApplication : Starting JavabackendTrainingApplication...
INFO --- [main] o.s.b.w.embedded.tomcat.Tomcat      : Tomcat initialized with port 8081 (http)
INFO --- [main] o.f.core.internal.command.DbMigrate : Successfully applied X migrations
INFO --- [main] c.j.b.JavabackendTrainingApplication : Started JavabackendTrainingApplication in 15.234 seconds
```

### 6-4. 起動成功を確認しよう

**確認すべきメッセージ:**
- ✅ `Started JavabackendTrainingApplication in X.XXX seconds` 
- ✅ `Tomcat started on port 8081`
- ✅ `Successfully applied 2 migrations to schema` （データベース初期化完了）

**Flywayマイグレーション確認:**
アプリケーション起動時に、以下のFlywayメッセージが表示されることを確認してください：

```
INFO --- [main] o.f.core.internal.command.DbMigrate : Migrating schema "public" to version "1 - Init database with 5 users"
INFO --- [main] o.f.core.internal.command.DbMigrate : Migrating schema "public" to version "2 - Insert 5 users with profiles"
INFO --- [main] o.f.core.internal.command.DbMigrate : Successfully applied 2 migrations
```

**重要**: V2__Insert_5_users_with_profiles.sql により、5人のサンプルユーザーが自動的に挿入されます。

**起動完了の判断:**
- コンソールにカーソルが表示されて、新しい行が出力されなくなる
- エラーメッセージが表示されていない

**⚠️ よくあるエラーと対処法:**
- **「Port 8081 already in use」**: 別のアプリケーションがポート8081を使用中 → 他のアプリを停止
- **「Connection refused」**: PostgreSQLコンテナが起動していない → `docker start trainee-postgres`
- **「ClassNotFoundException」**: ビルドが失敗している → `mvnw clean package` を再実行

---

## 7. アプリケーションの動作確認

**いよいよブラウザでアプリケーションを確認してみましょう！** 
アプリケーションが正常に動作していれば、ブラウザでWebページを見ることができます。

### 7-1. ブラウザでアプリケーションにアクセスしよう

**ブラウザ（Chrome、Firefox、Safariなど）を開いて、以下のURLにアクセス:**

#### **🏠 メインページ（ホーム画面）:**
```
http://localhost:8081
```

**期待される画面:**
- シンプルなホーム画面
- 「ユーザー管理システム」などのタイトル
- ナビゲーションメニュー

#### **👥 ユーザー一覧画面:**
```
http://localhost:8081/users
```

**期待される画面内容:**
- 登録されたユーザーの一覧表
- 「新規登録」ボタン
- 各ユーザーに対する「詳細表示」「編集」「削除」ボタン
- 日本語のラベル（氏名、メールアドレス、カテゴリなど）

#### **📖 Swagger UI（API仕様書）:**
```
http://localhost:8081/swagger-ui.html
```

**期待される画面内容:**
- API仕様の一覧
- 「User Controller」などのセクション
- 各APIエンドポイントの詳細
- 「Try it out」ボタンでAPIをテスト可能

### 7-2. 画面の表示内容を詳しく確認しよう

#### **ユーザー一覧画面で確認すべきポイント:**

**✅ 日本語表示:**
- 画面のタイトルやボタンが日本語で表示されている
- 「氏名」「メールアドレス」「カテゴリー」「ステータス」などのラベル

**✅ サンプルデータ:**
- **重要**: V2__Insert_5_users_with_profiles.sql により、5人のサンプルユーザーが自動表示されます
  - 山田 太郎（Level 0, 有効）
  - 佐藤 花子（Level 1, 有効）  
  - 鈴木 一郎（Level 2, 無効）
  - 田中 美咲（Level 3, 有効）
  - 高橋 健太（Level 4, 有効）
- 各ユーザーにプロフィール写真のファイル名が設定済み
- カテゴリは「Level 0」「Level 1」「Level 2」「Level 3」「Level 4」
- ステータスは「有効」「無効」

**✅ 操作ボタン:**
- 「新規登録」ボタン（画面上部）
- 各ユーザー行に「詳細」「編集」「削除」ボタン

#### **動作テスト（実際にクリックしてみよう）:**

1. **新規登録画面を開く:**
   - 「新規登録」ボタンをクリック
   - フォーム画面が表示されることを確認
   - 入力フィールドが日本語ラベルで表示されることを確認

2. **詳細画面を見る:**
   - 任意のユーザーの「詳細」ボタンをクリック
   - ユーザーの詳細情報が表示されることを確認
   - ユーザーのスキル情報も表示されることを確認

3. **編集画面を見る:**
   - 任意のユーザーの「編集」ボタンをクリック
   - フォームに既存データが入力されていることを確認

### 7-3. データベースの中身を直接確認しよう

**ターミナル・コマンドプロンプトでデータベースに接続:**
```bash
docker exec -it trainee-postgres psql -U trainee -d traineedb
```

**サンプルデータを確認するSQLコマンド:**

**1. ユーザーテーブルの確認:**
```sql
-- ユーザーの一覧を表示
SELECT id, name, email, category, status FROM users LIMIT 5;
```

**期待される出力例:**
```
 id |      name       |          email           |    category     | status 
----+-----------------+--------------------------+-----------------+--------
  1 | 田中 太郎       | tanaka@example.com       | FRONTEND        | ACTIVE
  2 | 佐藤 花子       | sato@example.com         | BACKEND         | ACTIVE
  3 | 鈴木 一郎       | suzuki@example.com       | FULLSTACK       | ACTIVE
```

**2. スキルテーブルの確認:**
```sql
-- ユーザーのスキル情報を表示
SELECT u.name, us.skill_name, us.skill_level 
FROM users u 
INNER JOIN user_skills us ON u.id = us.user_id 
LIMIT 10;
```

**期待される出力例:**
```
      name       | skill_name  | skill_level 
-----------------+-------------+-------------
 田中 太郎       | JavaScript  |           4
 田中 太郎       | React       |           3
 佐藤 花子       | Java        |           5
 佐藤 花子       | Spring Boot |           4
```

**3. テーブル構造の確認:**
```sql
-- テーブル一覧を表示
\dt

-- usersテーブルの構造を確認
\d users

-- 接続を終了
\q
```

### 7-4. よくある問題と対処法

#### **🚫 ブラウザにアクセスできない場合:**

**「このサイトにアクセスできません」エラー:**
1. **アプリケーションが起動しているか確認:**
   - ターミナルで `Started JavabackendTrainingApplication` メッセージが出ているか
   - エラーメッセージが出ていないか

2. **ポート番号を確認:**
   - URLが `http://localhost:8081` であることを確認
   - `https://` ではなく `http://` であることを確認

3. **ファイアウォールの確認:**
   - セキュリティソフトがポート8081をブロックしていないか

#### **🚫 画面が表示されるがデータがない場合:**

**「ユーザー一覧」が空の場合:**
1. **データベース接続を確認:**
   ```bash
   docker exec -it trainee-postgres psql -U trainee -d traineedb -c "SELECT COUNT(*) FROM users;"
   ```

2. **マイグレーションが実行されたか確認:**
   - アプリケーション起動ログで `Successfully applied X migrations` を確認

#### **🚫 日本語が文字化けしている場合:**

1. **ブラウザの文字エンコーディング設定を確認**
2. **データベースの文字コード設定を確認**

**全てが正常に表示されれば、環境構築は完了です！** 🎉

---

## 8. 開発環境の設定（オプション）

### 8-1. IDE推奨設定

#### IntelliJ IDEA（推奨）
**推奨理由:**
- Spring Boot完全サポート（プロジェクト作成ウィザード、自動設定認識）
- Maven統合（pom.xml自動認識、依存関係管理）
- 内蔵データベースツール（DB接続、SQLエディタ、ERD表示）
- Thymeleafサポート（シンタックスハイライト、オートコンプリート）
- 優秀なデバッグ機能（ブレークポイント、ホットリロード対応）

**必須プラグイン:**
- Lombok プラグイン
- Japanese Language Pack（日本語化）

**プロジェクト設定:**
- Project SDK: Java 21
- Project language level: 21
- Maven auto-import: 有効化

#### Eclipse（代替案）
- STS（Spring Tool Suite）の使用推奨
- Lombok プラグインを有効化
- Java 21プロジェクト設定の確認

### 8-2. ホットリロードの確認
Spring Boot DevToolsが有効のため、コード変更時に自動でアプリケーションが再起動します。

---

## 9. Flywayによるデータベース構築

### 9-1. Flywayの自動実行
**Flyway**がデータベースのテーブル作成とサンプルデータ挿入を自動実行します。

**重要**: アプリケーション起動時に以下の2つのマイグレーションが自動実行されます:
- **V1**: データベーステーブル作成
- **V2__Insert_5_users_with_profiles.sql**: 5人のサンプルユーザーデータ挿入

### 9-2. 構築成功の確認

**アプリケーション起動ログで以下を確認:**
```
INFO --- [main] o.f.core.internal.command.DbMigrate : Successfully applied 2 migrations
```

**Flywayの状態確認:**
```bash
# Windows
mvnw.cmd flyway:info

# macOS/Linux
./mvnw flyway:info
```

**正常な場合の出力:**
```
+-----------+---------+------------------------------+----------+---------------------+---------+
| Category  | Version | Description                  | Type     | Installed On        | State   |
+-----------+---------+------------------------------+----------+---------------------+---------+
| Versioned | 2       | Insert 5 users with profiles | SQL      | 2025-XX-XX XX:XX:XX | Success |
+-----------+---------+------------------------------+----------+---------------------+---------+
```

### 9-3. データベース確認

**ユーザー一覧画面で確認:**
`http://localhost:8080/users` にアクセスし、5人のサンプルユーザーが表示されることを確認してください。

**トラブル時のリセット:**
```bash
# データベース完全リセット
docker exec trainee-postgres psql -U trainee -d traineedb -c "DROP SCHEMA public CASCADE; CREATE SCHEMA public;"
./mvnw flyway:migrate
```

---

## 10. テストの実行

### 10-1. 単体テストの実行
```bash
./mvnw test
```

### 10-2. テスト成功の確認
```
Tests run: X, Failures: 0, Errors: 0, Skipped: 0
[INFO] BUILD SUCCESS
```

---

## 11. トラブルシューティング

### 11-1. よくあるエラーと対処法

#### **ポート8081がすでに使用されている場合**
```bash
# 使用中のプロセスを確認
lsof -i :8081  # macOS/Linux
netstat -ano | findstr :8081  # Windows

# application.propertiesでポート変更
server.port=8082
```

#### **PostgreSQLに接続できない場合**
```bash
# コンテナの状態確認
docker ps -a

# コンテナが停止している場合は再起動
docker start trainee-postgres

# ログを確認
docker logs trainee-postgres
```

#### **Java バージョンエラー**
```bash
# JAVA_HOME の確認
echo $JAVA_HOME  # macOS/Linux
echo %JAVA_HOME%  # Windows

# 正しいJavaバージョンに切り替え
export JAVA_HOME=/path/to/java-21  # macOS/Linux
```

#### **Maven ビルドエラー**
```bash
# Maven キャッシュをクリア
./mvnw dependency:purge-local-repository

# 再ビルド
./mvnw clean compile
```

### 11-2. ログファイルの確認
アプリケーションのログは以下の場所に出力されます：
```
spring.log  # プロジェクトルートディレクトリ
```

---

## 12. 開発開始前の最終確認チェックリスト

**Windowsユーザー:**
- [ ] WSL2がインストールされ、正常に動作している
- [ ] Ubuntu 22.04が正常にインストールされている
- [ ] WSL Ubuntu環境から基本コマンドが使用できる

**全ユーザー共通:**
- [ ] Java 21がインストールされ、`java -version`で確認済み
- [ ] Dockerがインストールされ、動作確認済み
- [ ] PostgreSQLコンテナが正常に起動している
- [ ] プロジェクトのビルドが成功している
- [ ] アプリケーションが http://localhost:8081 で起動している
- [ ] ユーザー一覧画面にサンプルデータが表示されている
- [ ] Swagger UIが http://localhost:8081/swagger-ui.html でアクセスできる
- [ ] テストが全て成功している

---

## 補足情報

### データベース情報
- **データベース名**: traineedb
- **ユーザー名**: trainee  
- **パスワード**: trainee
- **ポート**: 5432
- **接続URL**: jdbc:postgresql://localhost:5432/traineedb

### 主要な技術スタック
- **Spring Boot**: 3.4.8
- **Java**: 21
- **データベース**: PostgreSQL 15
- **テンプレートエンジン**: Thymeleaf
- **ビルドツール**: Maven 3.9.x
- **DBマイグレーション**: Flyway

### 重要なファイル
- `pom.xml` - Maven設定ファイル
- `application.properties` - アプリケーション設定
- `CLAUDE.md` - プロジェクト固有の開発ガイド
- `src/main/resources/db/migration/` - DBマイグレーションファイル

---

## 参考リンク

- [Spring Boot Documentation](https://spring.io/projects/spring-boot)
- [Flyway Documentation](https://documentation.red-gate.com/flyway/)
- [IntelliJ IDEA Documentation](https://www.jetbrains.com/help/idea/)
- [Thymeleaf Documentation](https://www.thymeleaf.org/documentation.html)
- [PostgreSQL Documentation](https://www.postgresql.org/docs/)
- [Maven Documentation](https://maven.apache.org/guides/)

---

この環境構築手順書に従って作業を進めれば、train-traineeプロジェクトの開発環境が正常に構築できます。問題が発生した場合は、トラブルシューティングセクションを参照してください。