  
**1) categories（カテゴリ・マスタ）※INNER対象**

|   |   |   |   |   |   |   |   |   |
|---|---|---|---|---|---|---|---|---|
|**#**|**Column**|**Type**|**PK**|**NN**|**UQ**|**FK**|**Default**|**Remarks**|
|1|id|BIGSERIAL|✔|✔||||主キー|
|2|name|VARCHAR(32)||✔|✔|||例: General / VIP / Internal|

• Index: ux_categories_name (UNIQUE)

- FK参照先削除時は通常RESTRICT

  

**2) statuses（ステータス・マスタ）※INNER対象**

|   |   |   |   |   |   |   |   |   |
|---|---|---|---|---|---|---|---|---|
|**#**|**Column**|**Type**|**PK**|**NN**|**UQ**|**FK**|**Default**|**Remarks**|
|1|id|BIGSERIAL|✔|✔||||主キー|
|2|name|VARCHAR(16)||✔|✔|||例: Active / Inactive|

• Index: ux_statuses_name (UNIQUE)

- FK参照先削除時は通常RESTRICT

  

**3) tags（タグ・マスタ）**

|   |   |   |   |   |   |   |   |   |
|---|---|---|---|---|---|---|---|---|
|**#**|**Column**|**Type**|**PK**|**NN**|**UQ**|**FK**|**Default**|**Remarks**|
|1|id|BIGSERIAL|✔|✔||||主キー|
|2|code|VARCHAR(8)||✔|✔|||例: A / B / C / D|
|3|label|VARCHAR(32)||✔||||表示名|

• Index: ux_tags_code (UNIQUE)

  

**4) entries（エントリ本体）※一覧の基表**

|   |   |   |   |   |   |   |   |   |
|---|---|---|---|---|---|---|---|---|
|**#**|**Column**|**Type**|**PK**|**NN**|**UQ**|**FK**|**Default**|**Remarks**|
|1|id|BIGSERIAL|✔|✔||||主キー|
|2|name|VARCHAR(50)||✔|||||
|3|email|VARCHAR(255)||✔|✔|||メール形式想定|
|4|category_id|BIGINT||✔||✔||→ categories.id（必須, ON DELETE RESTRICT）|
|5|status_id|BIGINT||✔||✔||→ statuses.id（必須, ON DELETE RESTRICT）|
|6|agree_newsletter|BOOLEAN||✔|||FALSE|同意チェック|
|7|created_at|TIMESTAMPTZ||✔|||NOW()|作成日時|
|8|updated_at|TIMESTAMPTZ||✔|||NOW()|更新日時|

• Index: ux_entries_email (UNIQUE)

- Index: ix_entries_category_id, ix_entries_status_id
- Index: ix_entries_id_desc（ORDER BY id DESC用）
- 備考：カテゴリ/ステータスを **NOT NULL + FK** にしているため、一覧で **INNER JOIN** が必須
- CHECK制約推奨: length(email) <= 255, length(name) <= 50
- 検索最適化オプション: pg_trgm + GINインデックス（name/email）

  

**5) entry_tags（エントリ×タグ：多対多）※OUTER対象のもと**

|   |   |   |   |   |   |   |   |   |
|---|---|---|---|---|---|---|---|---|
|**#**|**Column**|**Type**|**PK**|**NN**|**UQ**|**FK**|**Default**|**Remarks**|
|1|entry_id|BIGINT|(✔*)|✔||✔||→ entries.id（ON DELETE CASCADE）|
|2|tag_id|BIGINT|(✔*)|✔||✔||→ tags.id（ON DELETE RESTRICT）|
|3|created_at|TIMESTAMPTZ||✔|||NOW()|付与日時|

• PK: PK(entry_id, tag_id)

- Index: ix_entry_tags_tag_id
- 備考：タグ0件もあり得るため、一覧で件数/表示を出すなら **LEFT OUTER JOIN** が必要

  

**6) notes（任意ノート：一覧で最新1件を表示）※OUTER対象**

|   |   |   |   |   |   |   |   |   |
|---|---|---|---|---|---|---|---|---|
|**#**|**Column**|**Type**|**PK**|**NN**|**UQ**|**FK**|**Default**|**Remarks**|
|1|id|BIGSERIAL|✔|✔||||主キー|
|2|entry_id|BIGINT||✔||✔||→ entries.id（ON DELETE CASCADE）|
|3|body|TEXT||✔||||本文|
|4|created_at|TIMESTAMPTZ||✔|||NOW()|作成日時|

• Index: ix_notes_entry_id_created_at_desc（(entry_id, created_at DESC)）

- 備考：ノート未登録の行も一覧に出すため、**LEFT OUTER JOIN + ROW_NUMBER()/サブクエリ** で最新1件を取得

  

**7) audit_logs（監査ログ／NFR-004 推奨）**

|   |   |   |   |   |   |   |   |   |
|---|---|---|---|---|---|---|---|---|
|**#**|**Column**|**Type**|**PK**|**NN**|**UQ**|**FK**|**Default**|**Remarks**|
|1|id|BIGSERIAL|✔|✔||||主キー|
|2|event_at|TIMESTAMPTZ||✔|||NOW()|発生日時|
|3|actor|VARCHAR(64)||||||実行主体（ユーザID等）|
|4|action|VARCHAR(64)||✔||||例: CREATE/UPDATE/DELETE/ERROR|
|5|entity|VARCHAR(64)||||||例: entries|
|6|entity_id|BIGINT||||||対象ID|
|7|message|TEXT||||||例外メッセージ等（機密除外）|

**付録A：一覧画面での想定JOIN**

- 必須マスタ：entries **INNER JOIN** categories / statuses（NULL不可FKのため必ず存在）
- 任意情報：entries **LEFT OUTER JOIN** 集約済み entry_tags（タグ件数）／最新 notes（存在しない場合もある）

**付録B：制約・バリデーション要点**

1. entries.email は UNIQUE。形式検証はアプリ側 + DB長制約。
2. entries.category_id / status_id は NOT NULL FK。参照整合性を担保。
3. entry_tags は 複合PKで重複付与防止。
4. マスタ（categories, statuses, tags）は name/code を UNIQUE。
5. 監査は audit_logs にINSERT（例外時は安全なメッセージのみ格納）。
6. 必要に応じて pg_trgm + GIN インデックスでLIKE検索最適化。